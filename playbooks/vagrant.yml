---
- name: Install HashiCorp Vagrant from mirror
  hosts: all
  become: true
  vars:
    version: 2.4.1

  tasks:
    - name: Install Terraform DEB package from Yandex Cloud mirror
      ansible.builtin.apt:
        deb: >-
          https://hashicorp-releases.yandexcloud.net/vagrant/
          {{ version }}/vagrant_{{ version }}-1_{{ ansible_architecture }}.deb
        state: present
      when:
        - ansible_facts['distribution'] == "Debian"
        - use_hashicopr_repo == false


    - name: Register HashiCorp official APT repository
      ansible.builtin.deb822_repository:
        name: hashicorp
        types: deb
        uris: https://apt.releases.hashicorp.com
        suites: "{{ ansible_distribution_release }}"
        components: main
        signed_by: https://apt.releases.hashicorp.com/gpg
        state: present
      when:
        - ansible_facts['distribution'] == "Debian"
        - use_hashicopr_repo == true

    - name: Install Vagrant from HashiCorp official APT repository
      ansible.builtin.apt:
        pkg: vagrant
        state: present
        update_cache: true
      when:
        - ansible_facts['distribution'] == "Debian"
        - use_hashicorp_repo == true
